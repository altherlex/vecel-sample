(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-811e1c00"],{"859e":function(t,e,i){"use strict";var a=i("ecd0"),s=i.n(a);s.a},"8d2a":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container parent-page-container"},[i("div",{staticClass:"table-header"},[i("p",{staticClass:"table-title"},[t._v(t._s(t.$t("sentCommunications")))]),i("button",{staticClass:"btn primary-action-btn",attrs:{tag:"button"},on:{click:function(e){e.preventDefault(),t.newModalEnabled=!0}}},[i("font-awesome-icon",{attrs:{icon:"plus"}}),t._v(" "+t._s(t.$t("newCommunication"))+" ")],1)]),i("CustomTable",{attrs:{data:t.communications,columns:[[t.$t("date"),"created_timestamp","date",.4,"left"],[t.$t("subject"),"","subject",2,"left"],[t.$t("category"),"","category",.4,"left"],[t.$t("recipients"),"","recipients",.4,"right"],[t.$t("bouncedSpam"),"","fails",.6,"right"],[t.$t("deliveredView"),"","delivery",.6,"right"],[t.$t("type"),"","type",.6,"left"]],loading:!t.communicationsReady,emptyStateMessage:t.$t("emptyState.sentCommunications"),totalData:t.totalData,scrollWidth:800,filter:t.filter},on:{dataRequest:t.getCommunications,openModal:t.viewCommunication}},[i("template",{slot:"filters"},[i("div",{staticClass:"table-filter-bar"},[i("div",{staticClass:"table-filter-icon"},[i("font-awesome-icon",{attrs:{icon:"search"}})],1),i("div",{staticClass:"table-filter"},[i("Datepicker",{style:{zIndex:9999},attrs:{"popup-style":{top:"52px",left:0},lang:"en","value-type":"format",type:"text",name:"Date",placeholder:t.$t("date")},on:{change:function(e){return t.createFilter()}},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}})],1),i("div",{staticClass:"table-filter"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.subject,expression:"subject"}],staticClass:"form-control",class:{inputActive:""!==t.subject},attrs:{type:"text",name:"Subject",placeholder:t.$t("subject")},domProps:{value:t.subject},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.createFilter())},input:function(e){e.target.composing||(t.subject=e.target.value)}}})]),i("div",{staticClass:"table-filter"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.message,expression:"message"}],staticClass:"form-control",class:{inputActive:""!==t.message},attrs:{type:"text",name:"Message",placeholder:t.$t("message")},domProps:{value:t.message},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.createFilter())},input:function(e){e.target.composing||(t.message=e.target.value)}}})]),i("div",{staticClass:"table-filter"},[i("select",{directives:[{name:"model",rawName:"v-model",value:t.category,expression:"category"}],staticClass:"custom-select",class:{inputActive:t.category>-1},attrs:{name:"category"},on:{change:[function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.category=e.target.multiple?i:i[0]},function(e){return e.preventDefault(),t.createFilter(!0)}]}},[i("option",{attrs:{value:"-1"}},[t._v(t._s(t.$t("allCategories")))]),t._l(Object.keys(t.COMMUNICATION_CATEGORIES),(function(e){return i("option",{key:e,domProps:{value:e}},[t._v(" "+t._s(t.COMMUNICATION_CATEGORIES[e])+" ")])}))],2)]),i("div",{staticClass:"table-filter"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.recipientMinimum,expression:"recipientMinimum"}],staticClass:"form-control",class:{inputActive:""!==t.recipientMinimum},attrs:{type:"text",name:"Recipients",placeholder:t.$t("recipientMinimum")},domProps:{value:t.recipientMinimum},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.createFilter())},input:function(e){e.target.composing||(t.recipientMinimum=e.target.value)}}})]),i("div",{staticClass:"table-filter"},[i("select",{directives:[{name:"model",rawName:"v-model",value:t.communicationType,expression:"communicationType"}],staticClass:"custom-select",class:{inputActive:t.communicationType>-1},attrs:{name:"type"},on:{change:[function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.communicationType=e.target.multiple?i:i[0]},function(e){return e.preventDefault(),t.createFilter(!0)}]}},[i("option",{attrs:{value:"-1"}},[t._v(t._s(t.COMMUNICATION_TYPES[t.COMMUNICATION_TYPE_BOTH]))]),t._l(Object.keys(t.COMMUNICATION_TYPES).filter((function(e){return e!==String(t.COMMUNICATION_TYPE_BOTH)})),(function(e){return i("option",{key:e,domProps:{value:e}},[t._v(" "+t._s(t.COMMUNICATION_TYPES[e])+" ")])}))],2)]),i("div",{staticClass:"table-filter-clear"},[t.defaultFilter!==t.filter?i("font-awesome-icon",{attrs:{icon:"times",title:t.$t("clearFilter")},on:{click:function(e){return t.removeFilter()}}}):t._e()],1)])])],2),t.viewModalEnabled?i("SentCommunicationsModal",{attrs:{communication:t.viewedCommunication},on:{cancelModal:function(e){t.viewModalEnabled=!1}}}):t._e(),t.newModalEnabled?i("NewCommunicationModal",{on:{cancelModal:function(e){t.newModalEnabled=!1,t.communications=[],t.getCommunications()}}}):t._e()],1)},s=[],n=i("a34a"),o=i.n(n),c=i("9ab4"),r=i("60a3"),l=i("2f62"),u=i("2fe1"),m=i("ea76"),p=i.n(m),d=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("transition",{attrs:{name:"modal"}},[i("div",{staticClass:"modal-mask"},[i("div",{staticClass:"modal-wrapper"},[i("div",{staticClass:"modal-container modal-content wide-modal"},[i("div",{staticClass:"modal-header"},[i("p",{staticClass:"modal-title"},[t._v(t._s(t.$t("communicationDetails")))])]),i("div",{ref:t.scrollElementRef,staticClass:"modal-body"},[i("div",{staticClass:"router-tabs-bar"},[i("div",{staticClass:"router-tabs"},[i("div",{staticClass:"router-tab",class:{"router-link-active":"showMessage"===t.menuState},on:{click:function(e){t.menuState="showMessage"}}},[t._v(" "+t._s(t.$t("message"))+" ")]),i("div",{staticClass:"router-tab",class:{"router-link-active":"showContacts"===t.menuState},on:{click:function(e){t.menuState="showContacts"}}},[t._v(" "+t._s(t.$t("recipients"))+" ")])])]),"showMessage"===t.menuState?[i("div",{staticClass:"comm-summary"},[i("div",{staticClass:"comm-summary-subject"},[t._v(t._s(t.communication.subject))]),i("div",{staticClass:"horizontal-divider"}),i("div",{staticClass:"detail-list"},[i("p",[i("span",{staticClass:"list-label"},[t._v(t._s(t.$t("date"))+":")]),t._v(" "+t._s(t.communication.date)+" ")]),i("p",[i("span",{staticClass:"list-label"},[t._v(t._s(t.$t("type"))+":")]),t._v(" "+t._s(t.communication.type.value)+" ")]),i("p",[i("span",{staticClass:"list-label"},[t._v(t._s(t.$t("recipients"))+":")]),t._v(" "+t._s(t.communication.statistics.recipientsCount)+" "),t.communication.type.value==t.COMMUNICATION_TYPES[t.COMMUNICATION_TYPE_EMAIL]?[t._v(" "+t._s(t.$t("recipientCountOutdated"))+" ")]:t._e()],2)]),t.communication.type.value==t.COMMUNICATION_TYPES[t.COMMUNICATION_TYPE_EMAIL]?i("div",{staticClass:"detail-list"},[t.communication.statistics.deliveryPercentage?i("p",[i("span",{staticClass:"list-label"},[t._v(t._s(t.$t("constants.delivered"))+":")]),t._v(" "+t._s(t.communication.statistics.deliveryPercentage)+"% ")]):t._e(),t.communication.statistics.bouncedCount?i("p",[i("span",{staticClass:"list-label"},[t._v(t._s(t.$t("constants.bounced"))+":")]),t._v(" "+t._s(t.communication.statistics.bouncedCount)+"% ")]):t._e(),t.communication.statistics.spamCount?i("p",[i("span",{staticClass:"list-label"},[t._v(t._s(t.$t("constants.complaint"))+":")]),t._v(" "+t._s(t.communication.statistics.spamCount)+"% ")]):t._e(),t.communication.type.value==t.COMMUNICATION_TYPES[t.COMMUNICATION_TYPE_NOTIFICATION]?i("p",[i("span",{staticClass:"list-label"},[t._v(t._s(t.$t("constants.viewed"))+":")]),t._v(" "+t._s(t.communication.statistics.viewed)+"% ")]):t._e()]):t._e()]),i("div",{staticClass:"comm-summary-message",domProps:{innerHTML:t._s(t.communication.message)}})]:t._e(),"showContacts"===t.menuState?[i("CustomTable",{attrs:{data:t.recipients,columns:[[t.$t("name"),"","name",.8,"left"],[t.$t("email"),"","email",1.8,"left"],[t.$t("telephoneNo"),"","telephoneNo",1,"left"],[t.$t("type"),"","type",1,"left"],[t.$t("isUser"),"","isUser",1,"left"],[t.$t("status"),"","status",1,"left"]],loading:!t.recipientsReady,emptyStateMessage:t.$t("emptyState.contacts"),totalData:t.totalData,scrollWidth:947,scrollElementRef:t.$refs[t.scrollElementRef],filter:t.filter},on:{dataRequest:t.getRecipients}},[i("template",{slot:"filters"},[i("div",{staticClass:"table-filter-bar"},[i("div",{staticClass:"table-filter-icon"},[i("font-awesome-icon",{attrs:{icon:"search"}})],1),i("div",{staticClass:"table-filter"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.user,expression:"user"}],staticClass:"form-control",class:{inputActive:""!==t.user},attrs:{type:"text",name:"User",placeholder:t.$t("user")},domProps:{value:t.user},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.createRecipientFilter())},input:function(e){e.target.composing||(t.user=e.target.value)}}})]),i("div",{staticClass:"table-filter"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.business,expression:"business"}],staticClass:"form-control",class:{inputActive:""!==t.business},attrs:{type:"text",name:"Business",placeholder:t.$t("business")},domProps:{value:t.business},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.createRecipientFilter())},input:function(e){e.target.composing||(t.business=e.target.value)}}})]),i("div",{staticClass:"table-filter-clear"},[t.defaultFilter!==t.filter?i("font-awesome-icon",{attrs:{icon:"times",title:t.$t("clearFilter")},on:{click:function(e){return t.removeRecipientFilter()}}}):t._e()],1)])])],2)]:t._e()],2),i("div",{staticClass:"modal-footer"},[i("button",{staticClass:"btn secondary-action-btn",on:{click:function(e){return e.preventDefault(),t.$emit("cancelModal")}}},[t._v(" "+t._s(t.$t("cancel"))+" ")])])])])])])],1)},f=[],v=i("2e75"),h=i("7358"),y=i("25bf"),_=i("d59a"),C=i("88c3");function b(t){return b="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b(t)}function T(t,e,i,a,s,n,o){try{var c=t[n](o),r=c.value}catch(l){return void i(l)}c.done?e(r):Promise.resolve(r).then(a,s)}function g(t){return function(){var e=this,i=arguments;return new Promise((function(a,s){var n=t.apply(e,i);function o(t){T(n,a,s,o,c,"next",t)}function c(t){T(n,a,s,o,c,"throw",t)}o(void 0)}))}}function O(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function I(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function w(t,e,i){return e&&I(t.prototype,e),i&&I(t,i),t}function N(t,e){return!e||"object"!==b(e)&&"function"!==typeof e?E(t):e}function E(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function M(t){return M=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},M(t)}function k(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&S(t,e)}function S(t,e){return S=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},S(t,e)}var A=function(t){function e(){var t;return O(this,e),t=N(this,M(e).apply(this,arguments)),t.recipients=[],t.delivered=0,t.bounced=0,t.complaint=0,t.contactUsersCount=0,t.contactNonUsersCount=0,t.notificationsViewed=0,t.menuState="showMessage",t.recipientsReady=!0,t.defaultFilter="communication=".concat(t.communication?t.communication.id:null,"&"),t.filter=t.defaultFilter,t.totalData=0,t.user="",t.business="",t.scrollElementRef="sent-comm-modal",t}return k(e,t),w(e,[{key:"updateModal",value:function(){this.contactUsersCount=0,this.contactNonUsersCount=0,this.getRecipients()}},{key:"formatRecipients",value:function(t){var e=this;t.forEach((function(t){var i=t.viewed?C["a"].tc("viewed"):C["a"].tc("notViewed"),a=parseInt(e.communication.communicationType,10)===e.COMMUNICATION_TYPE_EMAIL?{value:e.EMAIL_STATUS[t.emailStatus],pillStyle:e.EMAIL_STATUS_STYLES[t.emailStatus]}:{value:i,pillStyle:t.viewed?"status-green":"status-red"},s={id:t.id,name:"".concat(t.contact.firstName," ").concat(t.contact.lastName),email:t.contact.emailAddress,telephoneNo:t.contact.telephoneNo?t.contact.telephoneNo:t.contact.cellphoneNo,type:t.contact.type.map((function(t){return e.CONTACT_TYPES_MASTER[t]})).join(", "),isUser:t.contact.customUserId?e.IS_USER[e.IS_USER_YES]:e.IS_USER[e.IS_USER_NO],status:a,action:{noAction:!0}};e.recipients.push(s)}))}},{key:"getRecipients",value:function(){var t=g(o.a.mark((function t(){var e,i,a,s,n,c,r=arguments;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=r.length>0&&void 0!==r[0]?r[0]:0,i=r.length>1&&void 0!==r[1]?r[1]:"",a=r.length>2&&void 0!==r[2]&&r[2],this.recipientsReady){t.next=5;break}return t.abrupt("return");case 5:return a&&(this.recipients=[]),this.recipientsReady=!1,t.next=9,this.getList("recipients",this.filter,e,this.TABLE_LIMIT,i);case 9:s=t.sent,n=s.data,c=s.count,this.totalData=c,this.formatRecipients(n),this.recipientsReady=!0;case 15:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"createRecipientFilter",value:function(){var t=g(o.a.mark((function t(){return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.filter=this.defaultFilter,this.user&&(this.filter+="user=".concat(this.user,"&")),this.business&&(this.filter+="business=".concat(this.business,"&"));case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"removeRecipientFilter",value:function(){var t=g(o.a.mark((function t(){return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.filter=this.defaultFilter,this.user="",this.business="";case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"setModalData",value:function(){var t=this;this.contactUsersCount=this.recipients.filter((function(t){return null!==t.contact.customUserId})).length,this.contactNonUsersCount=this.recipients.filter((function(t){return null===t.contact.customUserId})).length,this.delivered=this.recipients.filter((function(e){return e.emailStatus===t.EMAIL_DELIVERED})).length,this.bounced=this.recipients.filter((function(e){return e.emailStatus===t.EMAIL_BOUNCED})).length,this.complaint=this.recipients.filter((function(e){return e.emailStatus===t.EMAIL_COMPLAINT})).length,this.notificationsViewed=this.recipients.filter((function(t){return t.viewed})).length}}]),e}(Object(u["c"])(v["a"],h["a"],_["a"]));Object(c["a"])([Object(r["b"])()],A.prototype,"communication",void 0),Object(c["a"])([Object(r["d"])("communication",{immediate:!0,deep:!0})],A.prototype,"updateModal",null),A=Object(c["a"])([Object(r["a"])({components:{CustomTable:y["a"],TableService:_["a"]}})],A);var P=A,x=P,U=(i("bf86"),i("2877")),$=Object(U["a"])(x,d,f,!1,null,"1d3f7803",null),j=$.exports,R=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("transition",{attrs:{name:"modal"}},[i("div",{staticClass:"modal-mask"},[i("div",{staticClass:"modal-wrapper modal-dialog new-communication-modal"},[i("div",{staticClass:"modal-container modal-content wide-modal"},[i("div",{staticClass:"modal-header"},[i("div",{staticClass:"modal-title"},[t._v(t._s(t.$t("newCommunication")))]),i("div",{staticClass:"modal-steps"},[t._v("Step "+t._s(t.step)+" of 2")])]),i("div",{ref:t.scrollElementRef,staticClass:"modal-body"},[i("div",{directives:[{name:"show",rawName:"v-show",value:1===t.step,expression:"step === 1"}],staticClass:"fancy-toggle-selection"},[i("div",{staticClass:"section-label"},[t._v(t._s(t.$t("chooseType")))]),i("b-row",[i("b-col",[i("div",{staticClass:"fancy-toggle-option",class:[{selected:t.selection===t.COMMUNICATION_TYPE_EMAIL},{disabled:t.step>1&&t.selection===t.COMMUNICATION_TYPE_NOTIFICATION}],on:{click:function(e){e.preventDefault(),1==t.step&&(t.selection=t.COMMUNICATION_TYPE_EMAIL)}}},[i("div",{staticClass:"fancy-toggle-checkbox"},[i("b-form-checkbox",{staticClass:"form-check-input",attrs:{disabled:t.step>1&&t.selection===t.COMMUNICATION_TYPE_NOTIFICATION,type:"checkbox",value:t.COMMUNICATION_TYPE_EMAIL},model:{value:t.selection,callback:function(e){t.selection=e},expression:"selection"}})],1),i("div",{staticClass:"fancy-toggle-text"},[i("div",{staticClass:"title"},[t._v(t._s(t.$t("email")))]),i("div",{staticClass:"description"},[t._v(t._s(t.$t("emailDescription")))])])])]),i("b-col",[i("div",{staticClass:"fancy-toggle-option",class:[{selected:t.selection===t.COMMUNICATION_TYPE_NOTIFICATION},{disabled:t.step>1&&t.selection===t.COMMUNICATION_TYPE_EMAIL}],on:{click:function(e){e.preventDefault(),1===t.step&&(t.selection=t.COMMUNICATION_TYPE_NOTIFICATION)}}},[i("div",{staticClass:"fancy-toggle-checkbox"},[i("b-form-checkbox",{staticClass:"form-check-input",attrs:{disabled:t.step>1&&t.selection===t.COMMUNICATION_TYPE_EMAIL,type:"checkbox",value:t.COMMUNICATION_TYPE_NOTIFICATION},model:{value:t.selection,callback:function(e){t.selection=e},expression:"selection"}})],1),i("div",{staticClass:"fancy-toggle-text"},[i("div",{staticClass:"title"},[t._v(t._s(t.$t("notification")))]),i("div",{staticClass:"description"},[t._v(t._s(t.$t("notificationDescription")))])])])])],1)],1),1===t.step?i("div",{staticClass:"section-label"},[t._v(t._s(t.$t("customizeCommunication")))]):t._e(),t.selection!==t.COMMUNICATION_TYPE_EMAIL||t.selectContacts||t.reviewSteps?t._e():i("div",[i("form",[i("b-row",[i("b-col",[i("div",{staticClass:"form-group"},[i("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedTemplate,expression:"selectedTemplate"},{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"custom-select",attrs:{"data-vv-name":"email-template"},on:{change:[function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.selectedTemplate=e.target.multiple?i:i[0]},function(e){t.getCommunicationQueries(t.selectedTemplate),t.createContactFilter()}]}},[i("option",{attrs:{disabled:"",value:"null"}},[t._v(t._s(t.$t("selectEmailTemplate")))]),t._l(t.emailTemplates,(function(e){return i("option",{key:e.value,domProps:{value:e}},[t._v(" "+t._s(e.templateName)+" ")])})),i("option",{attrs:{value:"customEmail"}},[t._v(t._s(t.$t("customEmail")))])],2),i("span",{staticClass:"form-error-message"},[t._v(t._s(t.errors.first("email-template")))])])]),i("b-col",[i("div",{staticClass:"form-group"},[i("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedQuery,expression:"selectedQuery"},{name:"validate",rawName:"v-validate",value:"customEmail"===t.selectedTemplate?"":"required",expression:"selectedTemplate === 'customEmail' ? '' : 'required'"}],key:"communication-queries",staticClass:"custom-select",attrs:{"data-vv-name":"communication-queries"},on:{change:[function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.selectedQuery=e.target.multiple?i:i[0]},function(e){return t.createContactFilter()}]}},[i("option",{attrs:{disabled:""},domProps:{value:{}}},[t._v(" "+t._s(t.communicationQueries.length?t.$t("selectQuery"):t.$t("noQueriesAvailable"))+" ")]),t._l(t.communicationQueries,(function(e){return i("option",{key:e.value,domProps:{value:e}},[t._v(" "+t._s(e.name)+" ")])}))],2),i("span",{staticClass:"form-error-message"},[t._v(t._s(t.errors.first("communication-queries"))+" ")])])])],1)],1),t.selectedTemplate&&"customEmail"===t.selectedTemplate?t._e():i("div",{staticClass:"communication-summary"},[t.selectedTemplate?t._e():[i("div",{staticClass:"communication-empty-state"},[i("div",{staticClass:"subject"},[t._v(t._s(t.$t("emailPreview")))]),i("div",{staticClass:"message"},[t._v(t._s(t.$t("selectTemplateView")))])])],t.selectedTemplate&&"customEmail"!==t.selectedTemplate?[i("div",{staticClass:"subject"},[t._v(t._s(t.selectedTemplate.subject))]),i("div",{staticClass:"message",domProps:{innerHTML:t._s(t.selectedTemplate.message)}})]:t._e()],2)]),t.selection!==t.COMMUNICATION_TYPE_NOTIFICATION&&"customEmail"!==t.selectedTemplate||1!==t.step?t._e():i("div",{staticClass:"new-communication-content"},[i("form",[i("input",{directives:[{name:"validate",rawName:"v-validate",value:"required|max:70",expression:"'required|max:70'"},{name:"model",rawName:"v-model",value:t.subject,expression:"subject"}],staticClass:"form-control",attrs:{type:"text",name:"subject",placeholder:t.$t("addSubject")},domProps:{value:t.subject},on:{input:function(e){e.target.composing||(t.subject=e.target.value)}}}),i("textarea",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"},{name:"model",rawName:"v-model",value:t.message,expression:"message"}],staticClass:"form-control",attrs:{name:"message",placeholder:t.$t("addMessage")},domProps:{value:t.message},on:{input:function(e){e.target.composing||(t.message=e.target.value)}}})])]),t.selectContacts?i("div",{staticClass:"new-communication-content"},[i("div",{staticClass:"comm-summary"},[i("div",{staticClass:"comm-summary-subject"},[t._v(t._s(t.$t("summary")))]),i("div",{staticClass:"horizontal-divider"}),i("div",{staticClass:"detail-list"},[i("p",[i("span",{staticClass:"list-label"},[t._v(t._s(t.$t("totalRecipients"))+":")]),t._v(" "+t._s(t.totalData)+" ")]),t.communicationQueries.length&&"customEmail"!==t.selectedTemplate&&t.selection===t.COMMUNICATION_TYPE_EMAIL?i("p",[i("span",{staticClass:"list-label"},[t._v(t._s(t.$t("filter"))+":")])]):t._e(),t.selectedQuery?i("div",{domProps:{innerHTML:t._s(t.selectedQuery.description)}}):t._e()])]),i("CustomTable",{attrs:{data:t.contacts,columns:[[t.$t("name"),"","name",.8,"left"],[t.$t("email"),"","email",1.8,"left"],[t.$t("type"),"","type",1,"left"],[t.$t("isUser"),"","isUser",1,"right"]],loading:!t.contactsReady,emptyStateMessage:t.$t("emptyState.contactsWithEmail"),totalData:t.totalData,scrollWidth:947,scrollElementRef:t.$refs[t.scrollElementRef],filter:t.filter},on:{dataRequest:t.getContacts}},["customEmail"===t.selectedTemplate||t.selection===t.COMMUNICATION_TYPE_NOTIFICATION?i("template",{slot:"filters"},[i("div",{staticClass:"table-filter-bar"},[i("div",{staticClass:"table-filter-icon"},[i("font-awesome-icon",{attrs:{icon:"search"}})],1),i("div",{staticClass:"table-filter"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.businessName,expression:"businessName"}],staticClass:"form-control",class:{inputActive:""!==t.businessName},attrs:{type:"text",name:"Business Name",placeholder:t.$t("business")},domProps:{value:t.businessName},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.createContactFilter())},input:function(e){e.target.composing||(t.businessName=e.target.value)}}})]),i("div",{staticClass:"table-filter"},[i("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedParticipantType,expression:"selectedParticipantType"}],staticClass:"custom-select",attrs:{name:"selectedParticipantType"},on:{change:[function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.selectedParticipantType=e.target.multiple?i:i[0]},function(e){return e.preventDefault(),t.createContactFilter()}]}},[i("option",{attrs:{value:"-1"}},[t._v(t._s(t.$t("organizationLevel")))]),t._l(Object.keys(t.PARTICIPANT_TYPES),(function(e){return i("option",{key:e,domProps:{value:e}},[t._v(" "+t._s(t.PARTICIPANT_TYPES[e])+" ")])}))],2)]),i("div",{staticClass:"table-filter"},[i("b-form-select",{staticClass:"custom-select",attrs:{multiple:"","select-size":2,options:t.uConstants(t.CONTACT_TYPES_MASTER,t.uConfig(t.CONTACT_TYPES)),name:"contactType"},on:{input:function(e){return t.createContactFilter()}},model:{value:t.selectedType,callback:function(e){t.selectedType=e},expression:"selectedType"}})],1),i("div",{staticClass:"table-filter"},[i("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedIsUser,expression:"selectedIsUser"}],staticClass:"custom-select",attrs:{name:"selectedIsUser"},on:{change:[function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.selectedIsUser=e.target.multiple?i:i[0]},function(e){return e.preventDefault(),t.createContactFilter()}]}},[i("option",{attrs:{value:"-1"}},[t._v(t._s(t.$t("isUser")))]),t._l(Object.keys(t.IS_USER),(function(e){return i("option",{key:e,domProps:{value:e}},[t._v(" "+t._s(t.IS_USER[e])+" ")])}))],2)]),i("div",{staticClass:"table-filter-clear"},[t.defaultFilter!==t.filter?i("font-awesome-icon",{attrs:{icon:"times",title:t.$t("clearFilter")},on:{click:function(e){return t.removeContactFilter()}}}):t._e()],1)])]):t._e()],2)],1):t._e()]),i("div",{staticClass:"modal-footer"},[t.errors.any()?i("div",{staticClass:"modal-footer-error-message"},[t._v(" "+t._s(t.$t("formIncomplete"))+" ")]):t._e(),t.submitted?i("LoadingIcon",{attrs:{buttonLoader:!0}}):t._e(),2===t.step?i("button",{staticClass:"send-button btn primary-action-btn",attrs:{type:"submit"},on:{click:function(e){return e.preventDefault(),t.previous()}}},[t._v(" "+t._s(t.$t("previous"))+" ")]):t._e(),i("button",{staticClass:"send-button btn primary-action-btn",attrs:{disabled:t.submitted||!t.uHasGroup(t.USER_GROUP_AGENCY_MASTER),type:"submit"},on:{click:function(e){return e.preventDefault(),t.next()}}},[t._v(" "+t._s(2===t.step?t.$t("send"):t.$t("next"))+" ")]),t.uHasGroup(t.USER_GROUP_AGENCY_MASTER)?t._e():i("div",{staticClass:"form-error-message--permissions"},[t._v(" "+t._s(t.$t("higherPermissionsRequired"))+" ")]),i("button",{staticClass:"btn secondary-action-btn",on:{click:function(e){return e.preventDefault(),t.cancel()}}},[t._v(" "+t._s(t.$t("cancel"))+" ")])],1)])])])])],1)},F=[],Y=i("c5af");function D(t){return D="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},D(t)}function L(t,e,i,a,s,n,o){try{var c=t[n](o),r=c.value}catch(l){return void i(l)}c.done?e(r):Promise.resolve(r).then(a,s)}function Q(t){return function(){var e=this,i=arguments;return new Promise((function(a,s){var n=t.apply(e,i);function o(t){L(n,a,s,o,c,"next",t)}function c(t){L(n,a,s,o,c,"throw",t)}o(void 0)}))}}function q(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function G(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function B(t,e,i){return e&&G(t.prototype,e),i&&G(t,i),t}function H(t,e){return!e||"object"!==D(e)&&"function"!==typeof e?V(t):e}function V(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function z(t){return z=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},z(t)}function W(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&J(t,e)}function J(t,e){return J=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},J(t,e)}var K=function(t){function e(){var t;return q(this,e),t=H(this,z(e).apply(this,arguments)),t.selection=null,t.selectContacts=!1,t.subject="",t.message="",t.submitted=!1,t.contacts=[],t.contactsReady=!0,t.reviewSteps=!1,t.totalData=0,t.offset=0,t.defaultFilter="participant_contacts=true&email_address=true&",t.filter=t.defaultFilter,t.step=1,t.businessName="",t.selectedParticipantType=-1,t.selectedType=[],t.selectedIsUser=-1,t.emailTemplates=[],t.communicationQueries=[],t.selectedTemplate=null,t.selectedQuery={},t.scrollElementRef="new-comm-modal",t}return W(e,t),B(e,[{key:"mounted",value:function(){this.selection=this.COMMUNICATION_TYPE_EMAIL,this.getEmailTemplates()}},{key:"next",value:function(){var t=Q(o.a.mark((function t(){var e;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(2===this.step&&(this.sendCommunication(this.selection),this.submitted=!0),1!==this.step){t.next=8;break}return this.contacts=[],this.totalData=0,t.next=6,this.$validator.validate();case 6:e=t.sent,e&&(this.getContacts(),this.selectContacts=!0,this.step=2);case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"previous",value:function(){2===this.step&&(this.selectContacts=!1,this.step=1)}},{key:"cancel",value:function(){this.$emit("cancelModal"),this.step=1,this.subject="",this.message="",this.totalData=0,this.offset=0,this.selectedTemplate=null,this.selectedQuery={},this.removeContactFilter()}},{key:"sendCommunication",value:function(){var t=Q(o.a.mark((function t(e){var i;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.getContacts(0,"",!1,-1);case 2:return i={recipients:this.contacts.map((function(t){return t.id}))||[],communication_type:e,subject:this.subject,message:this.message,template:this.selectedTemplate?this.selectedTemplate.id:null,query:this.selectedQuery&&this.selectedQuery.id?this.selectedQuery.id:null},t.next=5,this.post("communications",i);case 5:this.cancel(),this.submitted=!1;case 7:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"formatContacts",value:function(t){var e=this;t.forEach((function(t){var i={id:t.id,name:"".concat(t.firstName," ").concat(t.lastName),email:t.emailAddress,type:t.type.map((function(t){return e.CONTACT_TYPES_MASTER[t]})).join(", "),isUser:t.customUserId?e.IS_USER[e.IS_USER_YES]:e.IS_USER[e.IS_USER_NO],action:{noAction:!0}};e.contacts.push(i)}))}},{key:"getContacts",value:function(){var t=Q(o.a.mark((function t(){var e,i,a,s,n,c,r,l=arguments;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=l.length>0&&void 0!==l[0]?l[0]:0,i=l.length>1&&void 0!==l[1]?l[1]:"",a=l.length>2&&void 0!==l[2]&&l[2],s=l.length>3&&void 0!==l[3]?l[3]:this.TABLE_LIMIT,this.contactsReady){t.next=6;break}return t.abrupt("return");case 6:return a&&(this.contacts=[]),this.contactsReady=!1,t.next=10,this.getList("contacts",this.filter,e,s,i);case 10:n=t.sent,c=n.data,r=n.count,this.totalData=r,this.formatContacts(c),this.contactsReady=!0;case 16:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getEmailTemplates",value:function(){var t=Q(o.a.mark((function t(){var e,i,a;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e="has_query=true",t.next=3,this.getList("email-templates",e);case 3:i=t.sent,a=i.data,this.emailTemplates=a;case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getCommunicationQueries",value:function(){var t=Q(o.a.mark((function t(e){var i,a,s,n;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if("customEmail"!==e){t.next=4;break}return this.communicationQueries=[],this.selectedQuery={},t.abrupt("return");case 4:return i="email_template=".concat(e.templateName),t.next=7,this.getList("communication-queries",i);case 7:a=t.sent,s=a.data,n=a.count,this.communicationQueries=s,n&&this.createContactFilter();case 12:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"createContactFilter",value:function(){var t=Q(o.a.mark((function t(){var e=this;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.filter=this.defaultFilter,this.selectedQuery&&this.selectedQuery.id&&(this.filter+="query=".concat(this.selectedQuery.id,"&")),this.businessName&&(this.filter+="business_name=".concat(this.businessName,"&")),this.selectedParticipantType>=0&&(this.filter+="participant_type=".concat(this.selectedParticipantType,"&")),this.selectedType.length&&this.selectedType.forEach((function(t){e.filter+="type=".concat(t,"&")})),this.selectedIsUser>=0&&(this.filter+="is_user=".concat(this.selectedIsUser,"&"));case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"removeContactFilter",value:function(){var t=Q(o.a.mark((function t(){return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.filter=this.defaultFilter,this.businessName="",this.selectedParticipantType=-1,this.selectedType=[],this.selectedIsUser=-1;case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}]),e}(Object(u["c"])(v["a"],h["a"],_["a"]));K=Object(c["a"])([Object(r["a"])({components:{CustomTable:y["a"],TableService:_["a"],LoadingIcon:Y["a"]}})],K);var X=K,Z=X,tt=(i("b49c"),Object(U["a"])(Z,R,F,!1,null,"4cd928c0",null)),et=tt.exports;function it(t){return it="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},it(t)}function at(t,e,i,a,s,n,o){try{var c=t[n](o),r=c.value}catch(l){return void i(l)}c.done?e(r):Promise.resolve(r).then(a,s)}function st(t){return function(){var e=this,i=arguments;return new Promise((function(a,s){var n=t.apply(e,i);function o(t){at(n,a,s,o,c,"next",t)}function c(t){at(n,a,s,o,c,"throw",t)}o(void 0)}))}}function nt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ot(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function ct(t,e,i){return e&&ot(t.prototype,e),i&&ot(t,i),t}function rt(t,e){return!e||"object"!==it(e)&&"function"!==typeof e?lt(t):e}function lt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ut(t){return ut=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ut(t)}function mt(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&pt(t,e)}function pt(t,e){return pt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},pt(t,e)}var dt=function(t){function e(){var t;return nt(this,e),t=rt(this,ut(e).apply(this,arguments)),t.total=1,t.offset=0,t.currentPage=1,t.defaultFilter="",t.filter="",t.communications=[],t.communicationsReady=!0,t.totalData=0,t.viewedCommunication={},t.viewModalEnabled=!1,t.newModalEnabled=!1,t.date="",t.communicationType=-1,t.recipientMinimum="",t.subject="",t.message="",t.category=-1,t}return mt(e,t),ct(e,[{key:"mounted",value:function(){this.uSetSupportToggle(this.SUPPORT_PANEL_SENT_COMMUNICATIONS),this.getCommunications()}},{key:"getCommunications",value:function(){var t=st(o.a.mark((function t(){var e,i,a,s,n,c,r=arguments;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=r.length>0&&void 0!==r[0]?r[0]:0,i=r.length>1&&void 0!==r[1]?r[1]:"",a=r.length>2&&void 0!==r[2]&&r[2],this.communicationsReady){t.next=5;break}return t.abrupt("return");case 5:return a&&(this.communications=[]),this.communicationsReady=!1,t.next=9,this.getList("communications",this.filter,e,this.TABLE_LIMIT,i);case 9:s=t.sent,n=s.data,c=s.count,this.totalData=c,this.formatCommunications(n),this.communicationsReady=!0;case 15:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"viewCommunication",value:function(t){this.viewedCommunication=t,this.viewModalEnabled=!0}},{key:"formatCommunications",value:function(t){var e=this;t.forEach((function(t){var i={value:e.COMMUNICATION_TYPES[t.communicationType],pillStyle:e.COMMUNICATION_TYPES_STYLES[t.communicationType]};t.communicationType||(i="");var a="-",s="-";parseInt(t.communicationType,10)===e.COMMUNICATION_TYPE_EMAIL?(a="".concat(t.statistics.deliveryPercentage,"%"),s=t.statistics.bouncedCount+t.statistics.spamCount):parseInt(t.communicationType,10)===e.COMMUNICATION_TYPE_NOTIFICATION&&(a="".concat((t.statistics.viewed/t.statistics.recipientsCount*100).toFixed(2),"%"));var n={id:t.id,date:t.created,subject:t.subject,message:t.message,type:i,communicationType:t.communicationType,recipients:t.statistics.recipientsCount,fails:s,delivery:a,emailTemplate:t.emailTemplate,statistics:t.statistics,category:e.COMMUNICATION_CATEGORIES[t.category],actions:[{modalCall:!0,canView:e.uHasGroup(e.USER_GROUP_AGENCY_MASTER)}]};e.communications.push(n)}))}},{key:"createFilter",value:function(){var t=st(o.a.mark((function t(){var e;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e="",this.communicationType>-1&&(e+="communication_type=".concat(this.communicationType)),this.category>-1&&(e+="category=".concat(this.category)),this.subject&&(e+="subject=".concat(this.subject,"&")),this.message&&(e+="message=".concat(this.message,"&")),this.recipientMinimum&&(e+="recipient_minimum=".concat(this.recipientMinimum,"&")),this.date&&(e+="date=".concat(this.date,"&")),this.filter=e;case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"removeFilter",value:function(){var t=st(o.a.mark((function t(){return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.communicationType=-1,this.category=-1,this.recipientMinimum="",this.subject="",this.message="",this.date="",this.filter="";case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}]),e}(Object(u["c"])(v["a"],h["a"],_["a"]));dt=Object(c["a"])([Object(r["a"])({components:{SentCommunicationsModal:j,NewCommunicationModal:et,CustomTable:y["a"],TableService:_["a"],Datepicker:p.a},computed:Object(l["b"])(["currentUser"])})],dt);var ft=dt,vt=ft,ht=(i("859e"),Object(U["a"])(vt,a,s,!1,null,"65a734d9",null));e["default"]=ht.exports},b49c:function(t,e,i){"use strict";var a=i("f0a1"),s=i.n(a);s.a},b794:function(t,e,i){},bf86:function(t,e,i){"use strict";var a=i("b794"),s=i.n(a);s.a},ecd0:function(t,e,i){},f0a1:function(t,e,i){}}]);